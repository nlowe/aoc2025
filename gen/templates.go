package main

const (
	rootTemplate = `// Code generated by 'go run ./gen'; DO NOT EDIT

package cmd

import (
	"fmt"
	"time"

	"github.com/pkg/profile"
	"github.com/spf13/cobra"
	"github.com/spf13/viper"

{{- if gt .N 0 }}
{{ range $day := seq 1 .N }}
	"github.com/nlowe/aoc2025/challenge/day{{ printf "%02d" $day }}"
{{- end }}
{{- end}}
	"github.com/nlowe/aoc2025/challenge/example"
)

func addDays(root *cobra.Command) {
	example.AddCommandsTo(root)
    {{- range $day := seq 1 .N }}
	day{{ printf "%02d" $day }}.AddCommandsTo(root)
    {{- end }}
}

type prof interface {
	Stop()
}

func NewRootCommand() *cobra.Command {
	var (
		start    time.Time
		profiler prof
	)

	result := &cobra.Command{
		Use:     "aoc2025",
		Short:   "Advent of Code 2022 Solutions",
		Long:    "Golang implementations for the 2022 Advent of Code problems",
		Example: "go run main.go 1 a -i ./challenge/day1/input.txt",
		Args:    cobra.ExactArgs(1),
		PersistentPreRun: func(_ *cobra.Command, _ []string) {
			if viper.GetBool("profile") {
				profiler = profile.Start()
			}

			start = time.Now()
		},
		PersistentPostRun: func(_ *cobra.Command, _ []string) {
			if profiler != nil {
				profiler.Stop()
			}

			fmt.Println("Took", time.Since(start))
		},
	}

	addDays(result)

	flags := result.PersistentFlags()

	flags.StringP("input", "i", "", "Input File to read. If not specified, assumes ./challenge/dayN/input.txt for the currently running challenge")
	flags.Bool("profile", false, "Profile implementation performance")

	_ = viper.BindPFlags(flags)

	return result
}
`

	glueTemplate = `// Code generated by 'go run ./gen'; DO NOT EDIT

package day{{ printf "%02d" .N }}

import "github.com/spf13/cobra"

func AddCommandsTo(root *cobra.Command) {
	day := &cobra.Command{
		Use:   "{{ printf "%02d" .N }}",
		Aliases: []string{"{{ .N }}"},
		Short: "Problems for Day {{ .N }}",
	}

	day.AddCommand(aCommand())
    day.AddCommand(bCommand())

	root.AddCommand(day)
}
`

	problemTemplate = `package day{{ printf "%02d" .N }}

import (
    "fmt"
    "io"

	"github.com/spf13/cobra"

    "github.com/nlowe/aoc2025/challenge"
	"github.com/nlowe/aoc2025/util"
)

func {{ .AB | toLower }}Command() *cobra.Command {
    return &cobra.Command{
        Use:   "{{ .AB | toLower }}",
        Short: "Day {{ .N }}, Problem {{ .AB }}",
        Run: func(_ *cobra.Command, _ []string) {
            fmt.Printf("Answer: %d\n", part{{ .AB | toUpper }}(challenge.InputFile()))
        },
    }
}

func part{{ .AB | toUpper }}(input io.Reader) int {
    panic("Not implemented!")
}
`

	testTemplate = `package day{{ printf "%02d" .N }}

import (
	"testing"

	"github.com/stretchr/testify/require"

	"github.com/nlowe/aoc2025/challenge"
)

func Test{{ .AB }}(t *testing.T) {
	t.Skip("Not Implemented")

	input := strings.NewReader("foobar")

	result := part{{ .AB | toUpper }}(input)

	require.Equal(t, 42, result)
}
`

	benchmarkTemplate = `package day{{ printf "%02d" .N }}

import (
	"testing"

	"github.com/nlowe/aoc2025/challenge"
)

func BenchmarkA(b *testing.B) {
	for b.Loop() {
		_ = partA(challenge.InputFile())
	}
}

func BenchmarkB(b *testing.B) {
	for b.Loop() {
		_ = partB(challenge.InputFile())
	}
}`
)
